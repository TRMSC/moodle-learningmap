<!-- Learningmap v.1.3 - Copyright (C) 2021, TRMSC - https://trmsc1.wordpress.com/ -->
<!-- GNU General Public Licence 3.0 - http://www.gnu.de/documents/gpl-3.0.en.html -->
<!-- CODE FOR AN AUTOMATED LEARNINGMAP DEPENDING ON THE CHECKLIST-PROGRESS  -->

<!-- J A V A S C R I P T - P A R T -->
<script>
    window.onload = function() {
		/* Wouldn't there a setTimeout call be better? */
        jquery_load_check_interval = setInterval(function() {
            if (window.jQuery) {
                loadLearningmap();
                console.log("jquery successfully loaded...");
                console.log($.fn.jquery);
                clearInterval(jquery_load_check_interval);
            } else {
                console.log("new try to load jquery...");
            }
        }, 150);

        function loadLearningmap() {
			
            let checklistState = getChecklistState();
            
            coverMap(checklistState);
            
            let mapPointsValue = Math.round(checklistState);
            
			$("#mapPoints").html(mapPointsValue);
            
			setEmblem(mapPointsValue);
			setMapStarValue(mapPointsValue);
            
            let dow = getDayOfWeek();
            setLeftDays(dow);
			setMotivationCall(mapPointsValue, dow);
            
			loadAnimation();
        }
    };
    
    /* Cover map */
    function coverMap(chklistState){
        /* Cover the map depending on the state */
        $("#mapCover").css({
            "margin-left": chklistState + "%"
        });
        $("#mapCover").css({
            width: 100 - chklistState + "%"
        }); 
    }
    
	/* Checklist state */
	function getChecklistState(){
		/* Get information from the checklist */
		let checklistFinish = parseFloat(
			$(".checklist_progress_outer")
			.css("width")
			.replace("%", "")
			.replace(",", ".")
		);
		let checklistProgress = Math.ceil(
			parseFloat(
				$(".checklist_progress_inner")
				.css("width")
				.replace("%", "")
				.replace(",", ".")
			)
		);
			
		/* Use checklistRoundup to exclude a result of eg 99%; Change border-radius if progress > o */
		var checklistRoundup = 0; 
		if (checklistProgress > 0) {
			checklistRoundup = 0.5;
			$("#mapCover").css({
				"border-radius": "0px 15px 15px 0px"
			});
		}
			
		/* Calculate the state */
		let checklistState = Math.ceil(checklistRoundup + checklistProgress / (checklistFinish / 100));
		if (checklistState > 100) {
			checklistState = 100;
		}
		return checklistState;
	}
	
    /* Emblem */
    function setEmblem(mapPts){
        /* Better would be, check if mapPts is less than 0 or greater than 100, then raise an "error":
           if(mapPts < 0 || mapPts > 100) {
                console.log("[ERR] Value out of range");
                return "fa-question"
           } else if ....
		   
		   => Error handling first
        */ 
		let emblem = "";
        if(mapPts >= 0 && mapPts < 33) {
            emblem = "fa-compass";
        } else if(mapPts < 66){
            emblem = "fa-flask";   
        } else if(mapPts < 100) {
            emblem = "fa-magic";  
        } else if(mapPts == 100){
            emblem = "fa-diamond";   
        }
		
        $("#mapEmblem").addClass(emblem);
    }
    
    /* Stars */
    function setMapStarValue(mapPts){
        let mapStar = "0";
		
		if(mapPts == 0){
			
        } else if(mapPts < 25) {
            mapStar = "1";
        } else if(mapPts < 50) {
            mapStar = "2";   
        } else if(mapPts < 75) {
            mapStar = "3";   
        } else if(mapPts < 100) {
            mapStar = "4";
        } else if(mapPts == 100) {
            mapStar = "5";   
        } else {
            console.log("[ERR] Value out of range");
        }
        $("#mapStars").html(mapStarValue);
    }
    
    /* Days */
    function setDayOfWeek(){
        var mapDateValue = new Date();
        var mapTodayValue = mapDateValue.getDay();
        if (mapTodayValue == 0) {
            mapTodayValue = 7;
        }
        return mapTodayValue;
    }
    
    function setLeftDays(today){
        const DAYS_OF_WEEK = 5;
        
        $("#mapToday").html(today);
        if (today > DAYS_OF_WEEK) {
            today = DAYS_OF_WEEK;
        }
        var mapLeftdaysValue = DAYS_OF_WEEK - today;
        if (mapLeftdaysValue == 1) {
            $("#mapLeftdays").html(mapLeftdaysValue + " Tag");
        } else {
            $("#mapLeftdays").html(mapLeftdaysValue + " Tage");
        }
    }
    
    /* Chart */
    function setMotivationCall(mapPts, today){
        let mapChartValue = mapPts / today;
		let mapChart = $("#mapChart").html();
        if(mapChartValue >= 20 && mapChartValue < 100){
            mapChart = "Weiter so!";
        } else if(mapChartValue < 20 && today < 5){
            mapChart = "Halte dich ran!";
        } else if(mapPts < 100 && today == 5){
            mapChart = "Letzte Chance!";
        } else if(mapPts >= 100){
            mapChart = "Starke Leistung!";
        }
		$("#mapChart").html(mapChart);
    }
	
	function loadAnimation(){
        /* Loading animation */
        $(".mapLoadingfield").css("filter", "opacity(1)");
		
		/* Wouldn't there a setTimeout call be better? */
        mapLoading = setInterval(function() {
            clearInterval(mapLoading);
           	$("#mapContent").css("cursor", "auto");
    	}, 2200);
	}
</script>

<!-- H T M L - P A R T -->
<!-- Cursor and Heading -->
<br>
<div id="mapContent" style="cursor:wait;">
    <h2 class="mapLoadingfield" style="text-align: center; transition: all cubic-bezier(0.41, 0.71, 0.57, 1) 2s; filter: opacity(0.9)">Deine Lernlandkarte in dieser Woche:</h2>

<!-- BACKGROUND OF THE MAP -->
    <div id="mapBackground" style="
  background-image: url(
  
GROßGESCHRIEBENES ERSETZEN: BILDADRESSE FÜR DEN HINTERGRUND OHNE ANFÜHRUNGSZEICHEN
                                         
  );
  background-size: cover;
  background-position: right;
  padding: 0px;
  border: 3px solid #c5c1ae;
  border-radius: 20px;          
  ">

<!-- COVER OF THE MAP -->
        <div id="mapCover" style="
    background-image: linear-gradient(271deg, rgb(0 0 0 / 7%) 95%, rgb(255 243 220 / 31%) 100%, transparent 35%), url(
                                  
GROßGESCHRIEBENES ERSETZEN: BILDADRESSE FÜR DIE ABDECKUNG OHNE ANFÜHRUNGSZEICHEN
                                  
    );
    background-size: initial;
    background-repeat: no-repeat;
    width: 100%;
    height: 350px;
    margin-left: 0%;
    border-radius: 15px;
    overflow: hidden;
    transition: all cubic-bezier(0.45, 0.71, 0.51, 1.22) 2s;  
    "></div>
    </div>
    <br>
    
<!-- Part under the map -->
    <div class="row mapLoadingfield" style="margin: 0px!important; padding-left: 10px; padding-right: 10px; transition: all cubic-bezier(0.41, 0.71, 0.57, 1) 2s; filter: opacity(0.7)">
        <div class="col-sm-1" style="align-self: center; text-align: left;">
            <h3>
                <i id="mapEmblem" class="fa" style="border: 2px #bbae8d; border-style: dashed; border-radius: 100%; padding: 8px; background-color: #f7ffba;"></i>
            </h3>
        </div>
        <div class="col">
            <h5 style="align-self: center; text-align: center">
                <i class="fa fa-star" style="border: 2px solid #6c757d; padding: 10px; margin-top: 5px; margin-bottom: 5px; border-radius: 10px 0px; background-color: rgb(245 255 169 / 80%);">&nbsp;<span id="mapStars"></span></i>&nbsp;&nbsp;|&nbsp;
                <i class="fa fa-leaf" style="border: 2px solid #6c757d; padding: 10px; margin-top: 5px; margin-bottom: 5px; border-radius: 10px 0px; background-color: rgb(245 255 169 / 80%);">&nbsp;<span id="mapPoints"></span>/100</i>&nbsp;&nbsp;|&nbsp;
                <i class="fa fa-map-pin" style="border: 2px solid #6c757d; padding: 10px; margin-top: 5px; margin-bottom: 5px; border-radius: 10px 0px; background-color: rgb(245 255 169 / 80%);">&nbsp;&nbsp;Tag&nbsp;<span id="mapToday"></span></i>&nbsp;&nbsp;|&nbsp;
                <i class="fa fa-fire" style="border: 2px solid #6c757d; padding: 10px; margin-top: 5px; margin-bottom: 5px; border-radius: 10px 0px; background-color: rgb(245 255 169 / 80%);">&nbsp;Noch&nbsp;<span id="mapLeftdays"></span></i>&nbsp;&nbsp;|&nbsp;
                <i class="fa fa-line-chart" style="border: 2px solid #6c757d; padding: 10px; margin-top: 5px; margin-bottom: 5px; border-radius: 10px 0px; background-color: rgb(245 255 169 / 80%);">&nbsp;<span id="mapChart"></span></i>
            </h5>
        </div>
        <div class="col-sm-1" style="align-self: center; text-align: right;">
            <h3>
                <a href="" onclick="javascript: window.location.href"><i class="fa fa-refresh" data-toggle="tooltip" title="" data-original-title="Neu laden"></i></a><br>
            </h3>
        </div>
    </div>
</div>

<!-- Vor dem Speichern sollte unter dieser Zeile <p><br></p> stehen. -->
<p><br></p>
